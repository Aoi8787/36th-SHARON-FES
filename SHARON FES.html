<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>36th SHARON FES PGサークルフォトサイト</title>
    <style>
        body {
            background-color: #e0e0e0;
            font-family: "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, sans-serif;
            text-align: center;
            padding: 20px;
        }
        h1 {
            color: #555;
            font-size: 2em;
            background: #FFF;
            border: solid 3px #555;
            border-radius: 15px;
            display: inline-block;
            padding: 10px 20px;
        }
        input[type="file"] {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            margin-top: 10px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #1976D2;
        }
        canvas {
            margin-top: 20px;
            border: 1px solid #555;
        }
        img {
            margin-top: 20px;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <h1>36th SHARON FES PGサークルフォトサイト</h1>

    <input type="file" @change="handleFileSelect" accept="image/*">
    <button @click="drawCanvas">画像を生成</button>

    <canvas id="canvas" width="720" height="1280"></canvas> <!-- 16:9 ratio -->
    <img :src="imageSrc" v-if="imageSrc" alt="生成された画像">

    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script>
        new Vue({
            el: 'body',
            data: {
                imageSrc: '', // 生成された画像のデータURL
                backgroundImg: null, // アップロードされた画像
                frameImageSrc: 'images/シャロン祭フレーム.png' // フレーム画像のパス
            },
            methods: {
                handleFileSelect(event) {
                    const file = event.target.files[0];
                    this.loadImage(file);
                },
                loadImage(file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.backgroundImg = e.target.result; // 背景画像のデータURLをセット
                    };
                    reader.readAsDataURL(file);
                },
                drawCanvas() {
                    const canvas = document.getElementById('canvas');
                    const context = canvas.getContext('2d');

                    // フレーム画像の読み込み
                    const frameImage = new Image();
                    frameImage.src = this.frameImageSrc;

                    // 背景画像（アップロードされた画像）の読み込み
                    const backgroundImage = new Image();
                    backgroundImage.src = this.backgroundImg;

                    // 背景画像が読み込まれた後に描画処理を行う
                    backgroundImage.onload = () => {
                        context.clearRect(0, 0, canvas.width, canvas.height);

                        // 背景画像をキャンバスに描画
                        const imgAspectRatio = backgroundImage.width / backgroundImage.height;
                        const canvasAspectRatio = canvas.width / canvas.height;
                        let drawWidth, drawHeight;
                        
                        if (imgAspectRatio > canvasAspectRatio) {
                            drawWidth = canvas.width;
                            drawHeight = canvas.width / imgAspectRatio;
                        } else {
                            drawHeight = canvas.height;
                            drawWidth = canvas.height * imgAspectRatio;
                        }

                        const x = (canvas.width - drawWidth) / 2;
                        const y = (canvas.height - drawHeight) / 2;
                        context.drawImage(backgroundImage, x, y, drawWidth, drawHeight);

                        // フレーム画像が読み込まれた後に描画
                        frameImage.onload = () => {
                            context.drawImage(frameImage, 0, 0, canvas.width, canvas.height);

                            // キャンバスの内容を画像として表示
                            this.imageSrc = canvas.toDataURL('image/jpeg');
                        };
                    };
                }
            }
        });
    </script>
</body>
</html>
